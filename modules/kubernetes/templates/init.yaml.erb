apiVersion: kubeadm.k8s.io/v1alpha3
kind: InitConfiguration
nodeRegistration:
  name: "<%= @hostname %>"
  criSocket: "/var/run/dockershim.sock"
  taints:
  - key: "kubeadmNode"
    value: "master"
    effect: "NoSchedule"
  kubeletExtraArgs:
    cgroupDriver: "cgroupfs"
apiEndpoint:
  advertiseAddress: "<%= @ipaddress %>"
  bindPort: 6443
---
apiVersion: kubeadm.k8s.io/v1alpha3
kind: ClusterConfiguration
etcd:
  external:
    endpoints:<% @etcd.each do |endpoint|%>
    - "https://<%= endpoint %>:2379"<% end -%>

    caFile: "/etc/ssl/dhtech-ca.pem"
    certFile: "/etc/ssl/cert/server-fullchain.crt"
    keyFile: "/etc/ssl/private/server.key"
networking:
  serviceSubnet: "<%= @servicenet %>"
  podSubnet: "<%= @podnet %>"
  dnsDomain: "<%= @variant %>.k8s.event.dreamhack.se"
kubernetesVersion: "v1.12.0"
controlPlaneEndpoint: "<%= @ipaddress %>:6443"
apiServerExtraArgs:
  authorization-mode: "Node,RBAC"
controllerManagerExtraArgs:
  node-cidr-mask-size: "26"
schedulerExtraArgs:
  address: "<%= @ipaddress %>"
apiServerCertSANs:
- "<%= @ipaddress %>"
- "<%= @hostname %>.event.dreamhack.se"
- "<%= @variant %>.control.event.dreamhack.se"
certificatesDir: "/etc/kubernetes/pki"
imageRepository: "k8s.gcr.io"
unifiedControlPlaneImage: "k8s.gcr.io/controlplane:v1.12.0"
auditPolicy:
  path: "/var/log/audit/audit.json"
  logDir: "/var/log/audit"
  logMaxAge: 7
featureGates:
  SelfHosting: false
clusterName: "<%= @variant %>"